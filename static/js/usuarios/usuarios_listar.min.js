function usernameBlurHandler(){$("#username").val(allTrim($("#username").val())),""!=$("#username").val()&&checkActiveUsername()}function BloquearInputs(){$(".inputdata").prop("readonly",!0).css("background-color","#F0EAE9"),$(".inputtextarea, .inputselect").prop("disabled",!0).css("background-color","#F0EAE9")}function checkActiveUsername(){var e=$("#username").val();$("#usernameMessage").removeClass(),$("#usernameMessage").html(""),$.ajax({async:!1,type:"POST",dataType:"json",url:"/usuarios/checkactiveusername/",data:{username:e,csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},success:function(e){var a=e.context;200==a.status?($("#usernameMessage").addClass("Short"),$("#usernameMessage").html(a.message),BloquearInputs(),CampoEnReadWrite("username")):($("#usernameMessage").addClass("Good"),$("#usernameMessage").html(a.message),$("input:not(#id)").prop("readonly",!1).css("background-color","#FFFFFF"),$("textarea, select").prop("disabled",!1).css("background-color","#FFFFFF"))}})}function CamposValidos(){var e=allTrim($("#username").val());return""==e?(mostrarMensaje("You must indicate username",MSG_STOP),!1):(e=allTrim($("#nombres").val()),""==e?(mostrarMensaje("You must indicate First Name",MSG_STOP),!1):(e=allTrim($("#apellidos").val()),""==e?(mostrarMensaje("You must indicate Last Name",MSG_STOP),!1):(e=allTrim($("#email").val()),""==e?(mostrarMensaje("You must indicate Email",MSG_STOP),!1):!!validarCorreo(e)||(mostrarMensaje("Email invalid",MSG_STOP),!1))))}function AgregarRegistro(){$("#username").on("blur",usernameBlurHandler),BloquearInputs(),$("#username").prop("readonly",!1).css("background-color","#FFFFFF"),$("#id").val(""),$("#perfil").val(0),$("#pais").val(1),$("#diagedit").dialog({title:"Add User",buttons:[{text:"Save",click:function(){CamposValidos()&&(EnviaPeticionAjax(AGREGAR_REG,0),$(this).dialog("close"))},class:"ui-corner-all",style:"color:Green"},{text:"Exit",click:function(){$(this).dialog("close")},class:"ui-corner-all",style:"color:Black"}]}),$("#username").focus(),$("#diagedit").dialog("open")}function EditarRegistro(e){$(".inputdata").prop("readonly",!1).css("background-color","#FFFFFF"),$(".inputselect").prop("disabled",!1).css("background-color","#FFFFFF"),$("#username").off("blur",usernameBlurHandler),$("#username").prop("readonly",!0).css("background-color","#F0EAE9"),PrepararRegistro(e),$("#nombres").focus(),$("#diagedit").dialog({title:"Edit User",buttons:[{text:"Save",click:function(){CamposValidos()&&(EnviaPeticionAjax(EDITAR_REG,e),$(this).dialog("close"))},class:"ui-corner-all",style:"color:Green"},{text:"Exit",click:function(){$(this).dialog("close")},class:"ui-corner-all",style:"color:Black"}]}),$("#username").focus(),$("#diagedit").dialog("open")}function VerRegistro(e){BloquearInputs(),PrepararRegistro(e),$("#username").off("blur",usernameBlurHandler),$("#diagedit").dialog({title:"View User",buttons:[{text:"Close",click:function(){$(this).dialog("close")},class:"ui-corner-all",style:"color:Green"}]}),$("#diagedit").dialog("open")}function EnviaPeticionAjax(e,a){var s=allTrim($("#username").val()),r=allTrim($("#nombres").val()),t=allTrim($("#apellidos").val()),o=allTrim($("#email").val()),l=$("#perfil option:selected").val(),i=$("#estado option:selected").val(),n=$("#pais option:selected").val(),c=$("#tipoactivo option:selected").val(),d=$("#area option:selected").val();try{$.ajax({async:!1,type:"POST",url:"/usuarios/usuarios_listar/",data:{accion:e,id:a,username:s,nombres:r,apellidos:t,email:o,perfil:l,estado:i,pais:n,tipoactivo:c,area:d,csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},success:function(e){""!=e?($("#datatablediv").html(""),$("#datatablediv").html(e),Crear_DataTable(),mostrarMensaje("Change made successfully",MSG_SUCCESS)):mostrarMensaje("UNKNOWN ERROR<br />Change NOT made",MSG_WARNING)}})}catch(e){MensajeErrorDesconocido(e)}}function PrepararRegistro(e){$.ajax({async:!1,type:"POST",dataType:"json",url:"/usuarios/ver_persona/",data:{id:e,csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},success:function(e){$("#id").val(e.id),$("#username").val(e.username),$("#nombres").val(e.nombres),$("#apellidos").val(e.apellidos),$("#email").val(e.email),$("#pais").val(e.pais),$("#estado").val(e.estado),$("#perfil").val(e.perfil),$("#tipoactivo").val(e.tipoactivo),$("#area").val(e.area)},error:function(e,a,s){reject(s)}})}function BloquearRegistro(e){confirmarMensaje("The user will be Disabled and will NOT be able to use the System.",CambiarEstadoPersona,e,0)}function DesBloquearRegistro(e){confirmarMensaje("The user will be Enabled and will be able to use the System.",CambiarEstadoPersona,e,1)}function CambiarEstadoPersona(e,a){try{$.ajax({type:"POST",url:"/usuarios/cambiar_estado/",dataType:"html",data:{id:e,estado:a,csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},success:function(e){""!=e?($("#datatablediv").html(""),$("#datatablediv").html(e),Crear_DataTable(),mostrarMensaje("Change made successfully",MSG_SUCCESS)):mostrarMensaje("UNKNOWN ERROR<br />Change NOT made",MSG_WARNING)}})}catch(e){MensajeErrorDesconocido(e)}}function PasswordValida(){var e=allTrim($("#txtPassword").val());if(""==e)return mostrarMensaje("You must enter Password",MSG_STOP),!1;var a=allTrim($("#txtConfirmPassword").val());return""==a?(mostrarMensaje("You must confirm your password.",MSG_STOP),!1):e!=a?(mostrarMensaje("Password Does Not Match",MSG_STOP),!1):!(e.length<8)||(mostrarMensaje("Password must have at least 8 characters",MSG_STOP),!1)}function CambiarClave(e){$("#strengthMessage").html(""),$("#strengthMessage").removeClass(),$("#passwdedit").dialog({title:"Change User Password",buttons:[{text:"Save",click:function(){PasswordValida()&&(EnviarPassword(e),$(this).dialog("close"))},class:"ui-corner-all",style:"color:Green"},{text:"Exit",click:function(){$(this).dialog("close")},class:"ui-corner-all",style:"color:Black"}]}),$("#passwdedit").dialog("open")}function EnviarPassword(e){try{$.ajax({type:"POST",dataType:"json",url:"/usuarios/admin_cambia_password/",data:{id:e,password:allTrim($("#txtPassword").val()),csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},success:function(e){200==e.status?mostrarMensaje(e.message,MSG_SUCCESS):mostrarMensaje(e.message+"<br />UNKNOWN ERROR<br />Change NOT made",MSG_WARNING)}})}catch(e){MensajeErrorDesconocido(e)}}function Crear_DataTable(){$("#tablaregs").DataTable({paging:!0,pagingType:"full_numbers",bJQueryUI:!0,iDisplayLength:25,order:[[0,"asc"]],columnDefs:[{orderable:!1,targets:[8]},{searchable:!1,targets:[8]}]}),$(".tip").tooltip()}$(document).ready(function(){try{var e=new LiveValidation("nombres");e.add(Validate.Presence)}catch(e){}try{var a=new LiveValidation("apellidos");a.add(Validate.Presence)}catch(e){}try{var s=new LiveValidation("email");s.add(Validate.Presence)}catch(e){}$("#diagedit").dialog({autoOpen:!1,position:{my:"center",at:"center",of:window},height:650,width:650,resizable:!1,modal:!0,show:{effect:"blind",duration:1e3},hide:{effect:"explode",duration:1e3},open:function(){},close:function(){$("#username").val(""),$("#nombres").val(""),$("#apellidos").val(""),$("#email").val(""),$("#perfil").val(0),$("#usernameMessage").removeClass(),$("#usernameMessage").html("")}}),$("#passwdedit").dialog({autoOpen:!1,position:{my:"center",at:"center",of:window},height:350,width:450,resizable:!1,modal:!0,show:{effect:"blind",duration:1e3},hide:{effect:"explode",duration:1e3},open:function(){ACCION==AGREGAR_REG&&VerificarRut()},close:function(){$("#txtPassword").val(""),$("#txtConfirmPassword").val("")}}),$("#txtPassword").keyup(function(){$("#strengthMessage").html(checkStrength($("#txtPassword").val()))}),$("#username").keyup(function(){$("#usernameMessage").removeClass(),$("#usernameMessage").html("")}),$("#perfil").on("change",function(){"0"===$(this).val()?($('#tipoactivo option[value="0"]').show(),$("#tipoactivo").val("1")):($('#tipoactivo option[value="0"]').hide(),$("#tipoactivo").val("0"))}),CampoEnReadOnly("id"),Crear_DataTable()});