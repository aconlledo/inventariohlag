function identificadorBlurHandler(){$("#identificador").val(allTrim($("#identificador").val())),""!=$("#identificador").val()&&checkActiveId()}function BloquearInputs(){$(".inputdata").prop("readonly",!0).css("background-color","#F0EAE9"),$(".inputtextarea, .inputselect").prop("disabled",!0).css("background-color","#F0EAE9")}function checkActiveId(){var a=$("#identificador").val();$("#activeidMessage").removeClass(),$("#activeidMessage").html(""),$.ajax({async:!1,type:"POST",dataType:"json",url:"/checkactiveid/",data:{identificador:a,csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},success:function(a){var e=a.context;200==e.status?($("#activeidMessage").addClass("Short"),$("#activeidMessage").html(e.message),BloquearInputs(),CampoEnReadWrite("identificador")):($("#activeidMessage").addClass("Good"),$("#activeidMessage").html(e.message),$("input:not(#id):not(#fingreso):not(#fmodifica)").prop("readonly",!1).css("background-color","#FFFFFF"),$("textarea, select").prop("disabled",!1).css("background-color","#FFFFFF"))}})}function PrepararRegistro(a){try{$.ajax({async:!1,type:"POST",dataType:"json",url:"/leeractivo/",data:{id:a,csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},success:function(a){var e=a.context;if(200==e.status){var i=a.registro;$("#id").val(i.id),$("#tipo").val(i.tipo),$("#identificador").val(i.identificador),$("#nombre").val(i.nombre),$("#modelo").val(i.modelo),$("#fabricante").val(i.fabricante),$("#sku").val(i.sku),$("#detalle").val(i.detalle),$("#serial").val(i.serial),$("#proveedor").val(i.proveedor),$("#owner").val(i.owner),$("#factura").val(i.factura),$("#fcompra").val(i.fcompra),$("#vcompra").val(i.vcompra),$("#factivacion").val(i.factivacion),$("#accounted").val(i.accounted),$("#vactual").val(i.vactual),$("#location").val(i.location),$("#building").val(i.building),$("#floor").val(i.floor),$("#zona").val(i.zona),$("#city").val(i.city),$("#country").val(i.country),$("#estado").val(i.estado),$("#festado").val(i.festado),$("#usuarioinv").val(i.usuarioinv),$("#fingreso").val(i.fingreso),$("#fmodifica").val(i.fmodifica)}else mostrarMensaje(e.message,MSG_WARNING)}})}catch(a){MensajeErrorDesconocido(a)}}function CamposValidos(){var a=allTrim($("#identificador").val());return""!=a||(mostrarMensaje("Debe indicar Identificador",MSG_STOP),!1)}function VerRegistro(a){BloquearInputs(),PrepararRegistro(a),$("#identificador").off("blur",identificadorBlurHandler),$("#diagedit").dialog({title:"View Asset",buttons:[{text:"Exit",click:function(){$(this).dialog("close")},class:"ui-corner-all",style:"color:Black"}]}),$("#diagedit").dialog("open")}function EditarRegistro(a){$("input:not(#id):not(#identificador):not(#fingreso):not(#fmodifica)").prop("readonly",!1).css("background-color","#FFFFFF"),$("textarea, select").prop("disabled",!1).css("background-color","#FFFFFF"),$("#identificador").off("blur",identificadorBlurHandler),CampoEnReadOnly("id"),CampoEnReadOnly("identificador"),CampoEnReadOnly("fingreso"),CampoEnReadOnly("fmodifica"),PrepararRegistro(a),$("#diagedit").dialog({title:"Edit Asset",buttons:[{text:"Save",click:function(){CamposValidos()&&(EnviaPeticionAjax(EDITAR_REG,a),$(this).dialog("close"))},class:"ui-corner-all",style:"color:Green"},{text:"Exit",click:function(){$(this).dialog("close")},class:"ui-corner-all",style:"color:Black"}]}),$("#diagedit").dialog("open")}function AgregarRegistro(){var a=$("#fcompra")[0]._flatpickr;a.setDate(new Date,!0);var e=$("#factivacion")[0]._flatpickr;e.setDate(new Date,!0);var i=$("#festado")[0]._flatpickr;i.setDate(new Date,!0),$("#identificador").on("blur",identificadorBlurHandler),BloquearInputs(),$("#identificador").prop("readonly",!1).css("background-color","#FFFFFF"),$("#tipo").prop("selectedIndex",0),$("#id").val(""),$("#identificador").val(""),$("#nombre").val(""),$("#modelo").val(""),$("#fabricante").val(""),$("#sku").val(""),$("#detalle").val(""),$("#item").val(""),$("#serial").val(""),$("#proveedor").val(""),$("#owner").val("0"),$("#factura").val(""),$("#vcompra").val(""),$("#accounted").val("1"),$("#vactual").val(""),$("#location").val("1"),$("#building").val("1"),$("#floor").val(""),$("#zona").val("1"),$("#city").val("1"),$("#country").val("1"),$("#estado").val("0"),$("#festado").val(fechadehoy()),$("#usuarioinv").val("23"),$("#fingreso").val(""),$("#fmodifica").val(""),$("#diagedit").dialog({title:"Add Asset",buttons:[{text:"Save",click:function(){CamposValidos()&&(EnviaPeticionAjax(AGREGAR_REG,0),$(this).dialog("close"))},class:"ui-corner-all",style:"color:Green"},{text:"Exit",click:function(){$(this).dialog("close")},class:"ui-corner-all",style:"color:Black"}]}),$("#diagedit").dialog("open")}function BorrarRegistro(a){BloquearInputs(),PrepararRegistro(a),$("#identificador").off("blur",identificadorBlurHandler),$("#diagedit").dialog({title:"Delete Asset",buttons:[{text:"Delete",click:function(){$(this).dialog("close"),confirmarMensaje("El Activo ser√° eliminado de la Base de Datos.",EnviaPeticionAjax,ELIMINAR_REG,a)},class:"ui-corner-all",style:"color:Red"},{text:"Exit",click:function(){$(this).dialog("close")},class:"ui-corner-all",style:"color:Green"}]}),$("#diagedit").dialog("open")}function EnviaPeticionAjax(a,e){let i=$("#diagedit :input").map(function(){let a=$(this).val();return"string"==typeof a&&(a=a.trim()),{name:this.name||this.id,value:a}}).get();i.push({name:"accion",value:a}),i.push({name:"csrfmiddlewaretoken",value:$("input[name=csrfmiddlewaretoken]").val()}),alert("id="+e);try{$.ajax({async:!1,type:"POST",dataType:"html",url:"/modificaractivo/",data:$.param(i),beforeSend:function(){$("#loader-msg-wait").show()},success:function(a){$("#loader-msg-wait").hide(),a?($("#datatablediv").html(a),Crear_DataTable(),mostrarMensaje("Change made successfully",MSG_SUCCESS)):mostrarMensaje("UNKNOWN ERROR<br />Change NOT made",MSG_WARNING)},error:function(a,e,i){$("#loader-msg-wait").hide();let t=a.responseJSON&&a.responseJSON.message?a.responseJSON.message:i||e;mostrarMensaje("UNKNOWN ERROR"+t,MSG_WARNING)}})}catch(a){MensajeErrorDesconocido(a)}}function Cargar_Modelos(){var a=$("#fabricante option:selected").val();try{$.ajax({method:"POST",dataType:"html",url:"/tablas/selectmodelos/",data:{fabricante:a,csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},success:function(a){""!=a?($("#divmodelos").html(""),$("#divmodelos").html(a)):mostrarMensaje("UNKNOW ERROR",MSG_WARNING)}})}catch(a){MensajeErrorDesconocido(a)}}function Cargar_Ciudades(a){var e=$("#country option:selected").val();try{$.ajax({method:"POST",dataType:"html",url:"/tablas/selectciudades/",data:{pais:e,csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},success:function(a){""!=a?($("#divciudades").html(""),$("#divciudades").html(a),$("#ciudad").attr({id:"city",name:"city"})):mostrarMensaje("UNKNOWN ERROR<br />Change NOT made",MSG_WARNING)}})}catch(a){MensajeErrorDesconocido(a)}}function Crear_DataTable(){$("#tablaregs").DataTable({destroy:!0,paging:!0,pagingType:"full_numbers",bJQueryUI:!0,iDisplayLength:25,order:[[1,"asc"]],columnDefs:[{orderable:!1,targets:[7]},{searchable:!1,targets:[0,7]}]}),$(".tip").tooltip()}$(document).ready(function(){var a=new LiveValidation("identificador");a.add(Validate.Presence),$("#fcompra").flatpickr({enableTime:!1,dateFormat:"d-m-Y",defaultDate:"today",locale:"es"}),$("#factivacion").flatpickr({enableTime:!1,dateFormat:"d-m-Y",defaultDate:"today",locale:"es"}),$("#festado").flatpickr({enableTime:!1,dateFormat:"d-m-Y",defaultDate:"today",locale:"es"}),$("#fabricante").on("change",function(){Cargar_Modelos()}),$("#diagedit").dialog({autoOpen:!1,position:{my:"center",at:"center",of:window},height:750,width:1300,resizable:!1,modal:!0,show:{effect:"blind",duration:1e3},hide:{effect:"explode",duration:1e3},open:function(){},close:function(){$("#id").val(""),$("#identificador").val(""),$("#activeidMessage").removeClass(),$("#activeidMessage").html("")}}),$("#identificador").keyup(function(){$("#activeidMessage").removeClass(),$("#activeidMessage").html("")}),$("#country").on("change",function(){CargarCiudades()}),Crear_DataTable()});